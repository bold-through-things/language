local myURL
	do URL
		string "https://example.com/path?query=123"

do print
	get pathname from myURL

do print
	string "\n--- Testing TextEncoder/TextDecoder ---"

local encoder
	do TextEncoder

local decoder
	do TextDecoder

local text_tests
	list
		type named str
		string "ASCII text"
		string "Unicode: ðŸ¦• Deno"
		string "Numbers: 42"

for text in
	get text_tests
	do
		
		
		local bytes
			do encode the encoder
				get text

		local restored
			do decode the decoder
				get bytes

		do print
			string `Text: "`
			get text
			string `" -> Bytes: [`
			get bytes
			string `] -> Restored: "`
			get restored

do print
	string "\n--- Testing atob/btoa ---"

local testString
	string "Hello World"

local encodedString
	do btoa
		get testString

local decodedString
	do atob
		get encodedString

do print
	string "Original: "
	get testString
	string " -> Encoded: "
	get encodedString
	string " -> Decoded: "
	get decodedString

do print
	string "\n--- Testing JSON.stringify/parse ---"

local testObj
	dict
		type named str for K
		type named str for V
		entry
			string "name"
			string "Claude"
		entry
			string "type"
			string "AI"
		entry
			string "version"
			string "42"

local jsonString
	do str:JSON the testObj

local parsedObj
	type named dict
		type named str for K
		type named 67lang:unknown for V
	do JSON:str the jsonString

do print
	string "Original object -> JSON: "
	get jsonString

do print
	string "Parsed back -> name: "
	do # the parsedObj
		string "name"

do print
	string "\n--- Testing fetch (data URL) ---"

do fetch as response
	string "data:application/json,{"67lang": "is fucking awesome"}"
	note the params
	dict
		type named str for K
		type named str for V

do print
	get response
	get json from response

type named MyEncoder is JS:object
	constructor TextEncoder

type named MyUint8Array is JS:object
	constructor Uint8Array

note TODO just honestly remove these here
fn encode is PrototypeCall
	sync
	constructor TextEncoder
	fn encode
	param self
		type named MyEncoder
	param input
		type named str
	returns
		type named MyUint8Array

local encoder2
	do MyEncoder

do print
	string "\n--- Testing custom MyEncoder ---"
	do encode
		get encoder2
		string "Custom encoding works!"
