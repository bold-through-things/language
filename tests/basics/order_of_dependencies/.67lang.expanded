67lang:file
	local lines
		stdin

	local _0x3_lines
		67lang:access_local lines
			noscope
				local _0x1_lines
					67lang:access_local lines

					67lang:auto_type

			local _0x2_split
				67lang:call split
					67lang:access_local _0x1_lines

					string "\n"

				67lang:auto_type

		67lang:auto_type

	local modules
		dict

	for line in
		67lang:assume_local_exists line

		local _0x7_lines
			67lang:access_local lines

			67lang:auto_type

		do
			local module
				dict

			local kv
				noscope
					local _0xa_line
						67lang:access_local line

						67lang:auto_type

				local _0xb_split
					67lang:call split
						67lang:access_local _0xa_line

						string ":"

						int 2

					67lang:auto_type

			noscope
				local _0x10_module
					67lang:access_local module

					67lang:auto_type

			local _0x11_id
				67lang:access_field _0x10_module id
					noscope
						local _0xd_kv
							67lang:access_local kv

							67lang:auto_type

						local _0xe__0
							67lang:access_field _0xd_kv 0

							67lang:auto_type

					local _0xf_trim
						67lang:call trim
							67lang:access_local _0xe__0

						67lang:auto_type

				67lang:auto_type

			noscope
				local _0x19_module
					67lang:access_local module

					67lang:auto_type

			local _0x1a_deps
				67lang:access_field _0x19_module deps
					noscope
						local _0x15_kv
							67lang:access_local kv

							67lang:auto_type

						local _0x16__1
							67lang:access_field _0x15_kv 1

							67lang:auto_type

						local _0x17_trim
							67lang:call trim
								67lang:access_local _0x16__1

							67lang:auto_type

					local _0x18_split
						67lang:call split
							67lang:access_local _0x17_trim

							regex /\s+/

						67lang:auto_type

				67lang:auto_type

			# TODO - this ought to be a macro.

			if
				eq
					noscope
						local _0x1f_kv
							67lang:access_local kv

							67lang:auto_type

						local _0x20__1
							67lang:access_field _0x1f_kv 1

							67lang:auto_type

					local _0x21_trim
						67lang:call trim
							67lang:access_local _0x20__1

						67lang:auto_type

					string ""

				then
					noscope
						local _0x22_module
							67lang:access_local module

							67lang:auto_type

					local _0x23_deps
						67lang:access_field _0x22_module deps
							list

						67lang:auto_type

			noscope
				local _0x27_modules
					67lang:access_local modules

					67lang:auto_type

			local _0x28_id
				67lang:access_index _0x27_modules
					noscope
						local _0x24_module
							67lang:access_local module

							67lang:auto_type

					local _0x25_id
						67lang:access_field _0x24_module id

						67lang:auto_type

					local _0x26_module
						67lang:access_local module

						67lang:auto_type

	# print
		string "modules"

		local _0x2c_modules
			67lang:access_local modules

			67lang:auto_type

	# TODO - support set initializers

	# TODO - support a  way to convert a dict keys to a set cleanly

	# (old code removed)

	local build_order
		list

	local dep_loops
		list

	fn visit
		67lang:assume_local_exists chain

		67lang:assume_local_exists module

		param module

		# chain of dependencies currently being inspected - used to detect loops

		param chain

		do
			if 
				noscope
					local _0x2f_module
						67lang:access_local module

						67lang:auto_type

				local _0x30_visited
					67lang:access_field _0x2f_module visited

					67lang:auto_type

				then
					return

			noscope
				local _0x31_module
					67lang:access_local module

					67lang:auto_type

			local _0x32_visited
				67lang:access_field _0x31_module visited
					true

				67lang:auto_type

			# TODO - this shouldn't be using slice. we need a dedicated copy command

			local next_chain
				noscope
					local _0x33_chain
						67lang:access_local chain

						67lang:auto_type

				local _0x34_slice
					67lang:call slice
						67lang:access_local _0x33_chain

					67lang:auto_type

			noscope
				local _0x38_next_chain
					67lang:access_local next_chain

					67lang:auto_type

			local _0x39_push
				67lang:call push
					67lang:access_local _0x38_next_chain

					noscope
						local _0x36_module
							67lang:access_local module

							67lang:auto_type

					local _0x37_id
						67lang:access_field _0x36_module id

						67lang:auto_type

				67lang:auto_type

			for dep_id in
				67lang:assume_local_exists dep_id

				noscope
					local _0x3c_module
						67lang:access_local module

						67lang:auto_type

				local _0x3d_deps
					67lang:access_field _0x3c_module deps

					67lang:auto_type

				do
					if
						exists
							local _0x40_dep_id
								67lang:access_local dep_id

								67lang:auto_type

							inside
								local _0x41_next_chain
									67lang:access_local next_chain

									67lang:auto_type

						then
							local dep_loop
								list

							noscope
								local _0x44_dep_loop
									67lang:access_local dep_loop

									67lang:auto_type

							local _0x45_push
								67lang:call push
									67lang:access_local _0x44_dep_loop

									local _0x43_dep_id
										67lang:access_local dep_id

										67lang:auto_type

								67lang:auto_type

							for chain_dep_id in
								67lang:assume_local_exists chain_dep_id

								noscope
									local _0x47_next_chain
										67lang:access_local next_chain

										67lang:auto_type

									local _0x48_slice
										67lang:call slice
											67lang:access_local _0x47_next_chain

										67lang:auto_type

								local _0x49_reverse
									67lang:call reverse
										67lang:access_local _0x48_slice

									67lang:auto_type

								do
									noscope
										local _0x4e_dep_loop
											67lang:access_local dep_loop

											67lang:auto_type

									local _0x4f_push
										67lang:call push
											67lang:access_local _0x4e_dep_loop

											local _0x4d_chain_dep_id
												67lang:access_local chain_dep_id

												67lang:auto_type

										67lang:auto_type

									if
										eq
											local _0x51_chain_dep_id
												67lang:access_local chain_dep_id

												67lang:auto_type

											local _0x52_dep_id
												67lang:access_local dep_id

												67lang:auto_type

										then
											break

							noscope
								local _0x53_dep_loop
									67lang:access_local dep_loop

									67lang:auto_type

							local _0x54_reverse
								67lang:call reverse
									67lang:access_local _0x53_dep_loop

								67lang:auto_type

							noscope
								local _0x57_dep_loops
									67lang:access_local dep_loops

									67lang:auto_type

							local _0x58_push
								67lang:call push
									67lang:access_local _0x57_dep_loops

									noscope
										local _0x55_dep_loop
											67lang:access_local dep_loop

											67lang:auto_type

									local _0x56_join
										67lang:call join
											67lang:access_local _0x55_dep_loop

											string " â†’ "

										67lang:auto_type

								67lang:auto_type

					else
						local _0x60_visit
							67lang:call visit
								noscope
									local _0x5c_modules
										67lang:access_local modules

										67lang:auto_type

								local _0x5d_id
									67lang:access_index _0x5c_modules
										local _0x5b_dep_id
											67lang:access_local dep_id

											67lang:auto_type

								local _0x5f_next_chain
									67lang:access_local next_chain

									67lang:auto_type

							67lang:auto_type

			noscope
				local _0x67_build_order
					67lang:access_local build_order

					67lang:auto_type

			local _0x68_push
				67lang:call push
					67lang:access_local _0x67_build_order

					noscope
						local _0x65_module
							67lang:access_local module

							67lang:auto_type

					local _0x66_id
						67lang:access_field _0x65_module id

						67lang:auto_type

				67lang:auto_type

	for module in
		67lang:assume_local_exists module

		values
			local _0x6b_modules
				67lang:access_local modules

				67lang:auto_type

		do
			local _0x6e_visit
				67lang:call visit
					local _0x6d_module
						67lang:access_local module

						67lang:auto_type

					list

				67lang:auto_type

	if
		asc
			int 1

			noscope
				local _0x70_dep_loops
					67lang:access_local dep_loops

					67lang:auto_type

			local _0x71_length
				67lang:access_field _0x70_dep_loops length

				67lang:auto_type

		then
			print
				concat
					string "ERROR: there are dependency loops.\n"

					noscope
						local _0x72_dep_loops
							67lang:access_local dep_loops

							67lang:auto_type

					local _0x73_join
						67lang:call join
							67lang:access_local _0x72_dep_loops

							string "\n"

						67lang:auto_type

	else
		print
			noscope
				local _0x74_build_order
					67lang:access_local build_order

					67lang:auto_type

			local _0x75_join
				67lang:call join
					67lang:access_local _0x74_build_order

					string "\n"

				67lang:auto_type


