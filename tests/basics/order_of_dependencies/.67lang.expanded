67lang:file
	local lines
		local _0x0_pipeline_result
			67lang:last_then
			67lang:call stdin
	local lines
		local _0x3_pipeline_result
			67lang:last_then
			67lang:call split
				67lang:call lines
				string "\n"
	local modules
		dict
			type str for K
			type Module for V
	do
		local _0x7_for_line__index
			int 0
		local _0x8_for_line__list
			local _0xa_pipeline_result
				67lang:last_then
				67lang:call lines
		while
			local _0xd_pipeline_result
				67lang:last_then
				67lang:call asc
					local _0xe_pipeline_result
						67lang:last_then
						67lang:call _0x7_for_line__index
					local _0x10_pipeline_result
						67lang:last_then
						67lang:call length
							67lang:call _0x8_for_line__list
			do
				local line
					local _0x13_pipeline_result
						67lang:last_then
						67lang:call #
							67lang:call _0x8_for_line__list
							local _0x14_pipeline_result
								67lang:last_then
								67lang:call _0x7_for_line__index
				local _0x18_pipeline_result
					67lang:last_then
					67lang:call _0x7_for_line__index
						local _0x19_pipeline_result
							67lang:last_then
							67lang:call add
								67lang:call _0x7_for_line__index
								int 1
				local kv
					local _0x1c_pipeline_result
						67lang:last_then
						67lang:call split
							67lang:call line
							string ":"
							int 2
				local _0x1f_pipeline_result
					67lang:last_then
					67lang:call #
						67lang:call kv
						int 0
				local id
					67lang:last_then
					67lang:call trim
						67lang:call _0x1f_pipeline_result
				local module
					local _0x22_pipeline_result
						67lang:last_then
						67lang:call Module
							local _0x23_pipeline_result
								67lang:last_then
								67lang:call id
							list
								type str
							false
				local _0x27_pipeline_result
					67lang:last_then
					67lang:call #
						67lang:call kv
						int 1
				local deps_str
					67lang:last_then
					67lang:call trim
						67lang:call _0x27_pipeline_result
				# TODO - this ought to be a macro.
				if
					local _0x2a_pipeline_result
						67lang:last_then
						67lang:call none
							local _0x2b_pipeline_result
								67lang:last_then
								67lang:call eq
									67lang:call deps_str
									string ""
				then
					local _0x2e_pipeline_result
						67lang:last_then
						67lang:call trim
							67lang:call deps_str
					local deps
						67lang:last_then
						67lang:call split
							67lang:call _0x2e_pipeline_result
							regex /\s+/
					local _0x31_pipeline_result
						67lang:last_then
						67lang:call deps
							67lang:call module
							local _0x32_pipeline_result
								67lang:last_then
								67lang:call deps
				local _0x35_pipeline_result
					67lang:last_then
					67lang:call #
						67lang:call modules
						local _0x36_pipeline_result
							67lang:last_then
							67lang:call id
								67lang:call module
						local _0x38_pipeline_result
							67lang:last_then
							67lang:call module
	# print
		string "modules"
		get modules
	# TODO - support set initializers
	# TODO - support a  way to convert a dict keys to a set cleanly
	# (old code removed)
	local unroller
		type DAG_unroller
		local _0xa9_pipeline_result
			67lang:last_then
			67lang:call DAG_unroller
				list
					type str
				list
					type str
				local _0xaa_pipeline_result
					67lang:last_then
					67lang:call modules
	do
		local _0xae_for_module__index
			int 0
		local _0xaf_for_module__list
			local _0xb1_pipeline_result
				67lang:last_then
				67lang:call values
					67lang:call modules
		while
			local _0xb4_pipeline_result
				67lang:last_then
				67lang:call asc
					local _0xb5_pipeline_result
						67lang:last_then
						67lang:call _0xae_for_module__index
					local _0xb7_pipeline_result
						67lang:last_then
						67lang:call length
							67lang:call _0xaf_for_module__list
			do
				local module
					local _0xba_pipeline_result
						67lang:last_then
						67lang:call #
							67lang:call _0xaf_for_module__list
							local _0xbb_pipeline_result
								67lang:last_then
								67lang:call _0xae_for_module__index
				local _0xbf_pipeline_result
					67lang:last_then
					67lang:call _0xae_for_module__index
						local _0xc0_pipeline_result
							67lang:last_then
							67lang:call add
								67lang:call _0xae_for_module__index
								int 1
				local _0xc3_pipeline_result
					67lang:last_then
					67lang:call visit
						local _0xc4_pipeline_result
							67lang:last_then
							67lang:call unroller
						local _0xc6_pipeline_result
							67lang:last_then
							67lang:call module
						list
							type str
	local _0xc9_pipeline_result
		67lang:last_then
		67lang:call unroller
	if
		local _0xcb_pipeline_result
			67lang:last_then
			67lang:call nondesc
				int 1
				local _0xcc_pipeline_result
					67lang:last_then
					67lang:call length
						67lang:call dep_loops
							67lang:call _0xc9_pipeline_result
	then
		local _0xcf_pipeline_result
			67lang:last_then
			67lang:call print
				local _0xd0_pipeline_result
					67lang:last_then
					67lang:call concat
						string "ERROR: there are dependency loops.\n"
						local _0xd1_pipeline_result
							67lang:last_then
							67lang:call join
								67lang:call dep_loops
									67lang:call _0xc9_pipeline_result
								string "\n"
	else
		local _0xd5_pipeline_result
			67lang:last_then
			67lang:call print
				local _0xd6_pipeline_result
					67lang:last_then
					67lang:call join
						67lang:call build_order
							67lang:call _0xc9_pipeline_result
						string "\n"

