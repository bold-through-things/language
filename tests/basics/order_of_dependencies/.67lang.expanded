67lang:file
	local lines
		local _0x0_stdin
			67lang:call stdin

			67lang:auto_type

	local _0x4_lines
		67lang:access_local lines
			noscope
				local _0x2_lines
					67lang:access_local lines

					67lang:auto_type

			local _0x3_split
				67lang:call split
					67lang:access_local _0x2_lines

					string "\n"

				67lang:auto_type

		67lang:auto_type

	local modules
		dict

	for line in
		67lang:assume_local_exists line

		local _0x8_lines
			67lang:access_local lines

			67lang:auto_type

		do
			local module
				dict

			local kv
				noscope
					local _0xb_line
						67lang:access_local line

						67lang:auto_type

				local _0xc_split
					67lang:call split
						67lang:access_local _0xb_line

						string ":"

						int 2

					67lang:auto_type

			noscope
				local _0x11_module
					67lang:access_local module

					67lang:auto_type

			local _0x12_id
				67lang:access_field _0x11_module id
					noscope
						local _0xe_kv
							67lang:access_local kv

							67lang:auto_type

						local _0xf__0
							67lang:access_field _0xe_kv 0

							67lang:auto_type

					local _0x10_trim
						67lang:call trim
							67lang:access_local _0xf__0

						67lang:auto_type

				67lang:auto_type

			noscope
				local _0x1a_module
					67lang:access_local module

					67lang:auto_type

			local _0x1b_deps
				67lang:access_field _0x1a_module deps
					noscope
						local _0x16_kv
							67lang:access_local kv

							67lang:auto_type

						local _0x17__1
							67lang:access_field _0x16_kv 1

							67lang:auto_type

						local _0x18_trim
							67lang:call trim
								67lang:access_local _0x17__1

							67lang:auto_type

					local _0x19_split
						67lang:call split
							67lang:access_local _0x18_trim

							regex /\s+/

						67lang:auto_type

				67lang:auto_type

			# TODO - this ought to be a macro.

			if
				local _0x23_eq
					67lang:call eq
						noscope
							local _0x20_kv
								67lang:access_local kv

								67lang:auto_type

							local _0x21__1
								67lang:access_field _0x20_kv 1

								67lang:auto_type

						local _0x22_trim
							67lang:call trim
								67lang:access_local _0x21__1

							67lang:auto_type

						string ""

					67lang:auto_type

				then
					noscope
						local _0x27_module
							67lang:access_local module

							67lang:auto_type

					local _0x28_deps
						67lang:access_field _0x27_module deps
							list

						67lang:auto_type

			noscope
				local _0x2c_modules
					67lang:access_local modules

					67lang:auto_type

			local _0x2d_id
				67lang:access_index _0x2c_modules
					noscope
						local _0x29_module
							67lang:access_local module

							67lang:auto_type

					local _0x2a_id
						67lang:access_field _0x29_module id

						67lang:auto_type

					local _0x2b_module
						67lang:access_local module

						67lang:auto_type

	# print
		string "modules"

		local _0x31_modules
			67lang:access_local modules

			67lang:auto_type

	# TODO - support set initializers

	# TODO - support a  way to convert a dict keys to a set cleanly

	# (old code removed)

	local build_order
		list

	local dep_loops
		list

	fn visit
		67lang:assume_local_exists chain

		67lang:assume_local_exists module

		param module

		# chain of dependencies currently being inspected - used to detect loops

		param chain

		do
			if 
				noscope
					local _0x35_module
						67lang:access_local module

						67lang:auto_type

				local _0x36_visited
					67lang:access_field _0x35_module visited

					67lang:auto_type

				then
					return

			noscope
				local _0x37_module
					67lang:access_local module

					67lang:auto_type

			local _0x38_visited
				67lang:access_field _0x37_module visited
					true

				67lang:auto_type

			# TODO - this shouldn't be using slice. we need a dedicated copy command

			local next_chain
				noscope
					local _0x39_chain
						67lang:access_local chain

						67lang:auto_type

				local _0x3a_slice
					67lang:call slice
						67lang:access_local _0x39_chain

					67lang:auto_type

			noscope
				local _0x3e_next_chain
					67lang:access_local next_chain

					67lang:auto_type

			local _0x3f_push
				67lang:call push
					67lang:access_local _0x3e_next_chain

					noscope
						local _0x3c_module
							67lang:access_local module

							67lang:auto_type

					local _0x3d_id
						67lang:access_field _0x3c_module id

						67lang:auto_type

				67lang:auto_type

			for dep_id in
				67lang:assume_local_exists dep_id

				noscope
					local _0x42_module
						67lang:access_local module

						67lang:auto_type

				local _0x43_deps
					67lang:access_field _0x42_module deps

					67lang:auto_type

				do
					if
						exists
							local _0x46_dep_id
								67lang:access_local dep_id

								67lang:auto_type

							inside
								local _0x47_next_chain
									67lang:access_local next_chain

									67lang:auto_type

						then
							local dep_loop
								list

							noscope
								local _0x4a_dep_loop
									67lang:access_local dep_loop

									67lang:auto_type

							local _0x4b_push
								67lang:call push
									67lang:access_local _0x4a_dep_loop

									local _0x49_dep_id
										67lang:access_local dep_id

										67lang:auto_type

								67lang:auto_type

							for chain_dep_id in
								67lang:assume_local_exists chain_dep_id

								noscope
									local _0x4d_next_chain
										67lang:access_local next_chain

										67lang:auto_type

									local _0x4e_slice
										67lang:call slice
											67lang:access_local _0x4d_next_chain

										67lang:auto_type

								local _0x4f_reverse
									67lang:call reverse
										67lang:access_local _0x4e_slice

									67lang:auto_type

								do
									noscope
										local _0x54_dep_loop
											67lang:access_local dep_loop

											67lang:auto_type

									local _0x55_push
										67lang:call push
											67lang:access_local _0x54_dep_loop

											local _0x53_chain_dep_id
												67lang:access_local chain_dep_id

												67lang:auto_type

										67lang:auto_type

									if
										local _0x59_eq
											67lang:call eq
												local _0x57_chain_dep_id
													67lang:access_local chain_dep_id

													67lang:auto_type

												local _0x58_dep_id
													67lang:access_local dep_id

													67lang:auto_type

											67lang:auto_type

										then
											break

							noscope
								local _0x5c_dep_loop
									67lang:access_local dep_loop

									67lang:auto_type

							local _0x5d_reverse
								67lang:call reverse
									67lang:access_local _0x5c_dep_loop

								67lang:auto_type

							noscope
								local _0x60_dep_loops
									67lang:access_local dep_loops

									67lang:auto_type

							local _0x61_push
								67lang:call push
									67lang:access_local _0x60_dep_loops

									noscope
										local _0x5e_dep_loop
											67lang:access_local dep_loop

											67lang:auto_type

									local _0x5f_join
										67lang:call join
											67lang:access_local _0x5e_dep_loop

											string " â†’ "

										67lang:auto_type

								67lang:auto_type

					else
						local _0x69_visit
							67lang:call visit
								noscope
									local _0x65_modules
										67lang:access_local modules

										67lang:auto_type

								local _0x66_id
									67lang:access_index _0x65_modules
										local _0x64_dep_id
											67lang:access_local dep_id

											67lang:auto_type

								local _0x68_next_chain
									67lang:access_local next_chain

									67lang:auto_type

							67lang:auto_type

			noscope
				local _0x70_build_order
					67lang:access_local build_order

					67lang:auto_type

			local _0x71_push
				67lang:call push
					67lang:access_local _0x70_build_order

					noscope
						local _0x6e_module
							67lang:access_local module

							67lang:auto_type

					local _0x6f_id
						67lang:access_field _0x6e_module id

						67lang:auto_type

				67lang:auto_type

	for module in
		67lang:assume_local_exists module

		local _0x75_values
			67lang:call values
				local _0x74_modules
					67lang:access_local modules

					67lang:auto_type

			67lang:auto_type

		do
			local _0x7a_visit
				67lang:call visit
					local _0x79_module
						67lang:access_local module

						67lang:auto_type

					list

				67lang:auto_type

	if
		local _0x7e_nondesc
			67lang:call nondesc
				int 1

				noscope
					local _0x7c_dep_loops
						67lang:access_local dep_loops

						67lang:auto_type

				local _0x7d_length
					67lang:call length
						67lang:access_local _0x7c_dep_loops

					67lang:auto_type

			67lang:auto_type

		then
			local _0x86_print
				67lang:call print
					local _0x83_concat
						67lang:call concat
							string "ERROR: there are dependency loops.\n"

							noscope
								local _0x81_dep_loops
									67lang:access_local dep_loops

									67lang:auto_type

							local _0x82_join
								67lang:call join
									67lang:access_local _0x81_dep_loops

									string "\n"

								67lang:auto_type

						67lang:auto_type

				67lang:auto_type

	else
		local _0x8c_print
			67lang:call print
				noscope
					local _0x8a_build_order
						67lang:access_local build_order

						67lang:auto_type

				local _0x8b_join
					67lang:call join
						67lang:access_local _0x8a_build_order

						string "\n"

					67lang:auto_type

			67lang:auto_type


